# K2Node

1.Referrence lib
```c++
#include "K2Node.h"
#include "EdGraphSchema_K2.h"
#include "BlueprintActionDatabaseRegistrar.h"
#include "BlueprintNodeSpawner.h"
```

1.1 Need Module
```
"UnrealEd",
"GraphEditor",
"KismetCompiler",
"BlueprintGraph",
```

2.base override function
```c++
//Regist to blurprint menu
void GetMenuActions(FBlueprintActionDatabaseRegistrar& ActionRegistrar) const override;

//Node name
FText GetNodeTitle(ENodeTitleType::Type TitleType) const override;

//node pin initialize
virtual void AllocateDefaultPins() override;


//make node do something
virtual void ExpandNode(class FKismetCompilerContext& CompilerContext, UEdGraph* SourceGraph) override;


```

3.Basic
3.1 create pin
```c++
CreatePin(EGPD_Input, UEdGraphSchema_K2::PC_Exec, UEdGraphSchema_K2::PN_Execute);

UEdGraphPin* InNamePin = CreatePin(EGPD_Input, UEdGraphSchema_K2::PC_Name,  FName(TEXT("Var Name")/*node name*/));
const UEdGraphSchema_K2* Schema = GetDefault<UEdGraphSchema_K2>();
Schema->SetPinAutogeneratedDefaultValue(InNamePin, FName("My Var Name").ToString());
```

3.2 Execute Function
3.2.1 find ufunciton
```c++
//#include "UObject/Class.h"
UFunction* Func = FindFunction(GET_FUNCTION_NAME_CHECKED(UMyK2Node/*class*/, SayNya/*ufunction name*/));


```

3.2.2 create intermidiate node
```c++
UK2Node_CallFunction* CallCreateNode = CompilerContext.SpawnIntermediateNode<UK2Node_CallFunction>(this, SourceGraph);

CallCreateNode->FunctionReference.SetExternalMember(GET_FUNCTION_NAME_CHECKED(UMyK2Node, SayNya), UMyK2Node::StaticClass());
```

3.2.3 connect pin to intermidiate
```c++
CompilerContext.MovePinLinksToIntermediate(*ExecPin/*this node pin*/, *CallCreateNode->GetExecPin()/*ufunction pin*/)
```

3.2.3 break links (MUST DO)
```
 BreakAllNodeLinks();
```


4.Other
4.1 
https://blog.csdn.net/u013507300/article/details/109165560
https://zhuanlan.zhihu.com/p/402041383
https://www.cxybb.com/article/u013412391/109347063
https://s1t2.com/blog/brief-intro-k2nodes
https://forums.unrealengine.com/t/tutorial-how-to-accept-wildcard-structs-in-your-ufunctions/18968
https://forums.unrealengine.com/t/making-a-custom-blueprint-k2node-in-c-can-anybody-help-me-please/26765

4.2 unfction expose more excution pin
meta = (ExpandEnumAsExecs = "Outcome")